<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-lang-key="benchmark_page_title">Nazarban AI - LLM Data Hub</title>

  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png" />
  <link rel="icon" href="favicon.ico" />
  <link rel="apple-touch-icon" href="logo.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />

  <style>
    /* Main body and layout styles */
    html {
      background-color: #0F172A; 
    }
    body {
      background-color: #0F172A; 
      color: #F1F5F9;
    }
    .page-wrapper {
        width: 100%;
        overflow-x: hidden;
    }
    .benchmark-container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .nav-mobile-overlay {
        width: 100% !important; 
        box-sizing: border-box;
    }
    .benchmark-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .benchmark-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
    }
    #last-updated {
      font-size: 1rem;
      color: #94A3B8;
    }
    .hero-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: #1E293B;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 1px solid #334155;
    }
    .stat-card-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #94A3B8;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
    }
    .stat-card-value {
      font-size: 2.25rem;
      font-weight: 800;
      color: #F1F5F9;
    }
    .stat-card-sub {
      font-size: 0.85rem;
      color: #64748B;
      margin-top: 0.25rem;
    }
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr); 
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    @media (max-width: 900px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }
    .chart-card {
      background: #1E293B; 
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 1px solid #334155;
      overflow: hidden; 
    }
    .chart-card h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-weight: 700;
      color: #E2E8F0;
    }
    .leaderboard-container {
      background: #1E293B;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 1px solid #334155;
      overflow-x: auto; 
      margin-bottom: 2rem;
      width: 100%;
      box-sizing: border-box;
    }
    .leaderboard-container h2 {
        margin-top: 0;
    }
    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
      text-align: left;
    }
    .leaderboard-table th, .leaderboard-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #334155;
    }
    .leaderboard-table th {
      color: #94A3B8;
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
    }
    .leaderboard-table td {
      color: #E2E8F0;
    }
    .leaderboard-table tr:last-child td {
      border-bottom: 0;
    }
    .leaderboard-table .rank {
      font-weight: 800;
      font-size: 1.1rem;
      color: #F1F5F9;
    }
    .leaderboard-table .grade-c {
      background-color: #374151;
      color: #F1F5F9;
      padding: 0.2rem 0.5rem;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.9rem;
      display: inline-block;
      min-width: 20px;
      text-align: center;
    }
    .insights-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    @media (max-width: 900px) {
      .insights-grid {
        grid-template-columns: 1fr;
      }
    }
    .insight-card {
      background: #1E293B;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 1.5rem;
    }
    .insight-card h3 {
      margin: 0 0 0.5rem 0;
      color: #3B82F6; 
    }
    .insight-card h4 {
      margin: 0 0 0.5rem 0;
      font-size: 1.25rem;
      color: #E2E8F0;
    }
    .insight-card p {
      margin: 0;
      color: #94A3B8;
    }
    .quick-facts-card {
        background: #1E293B;
        border: 1px solid #334155;
        border-radius: 12px;
        padding: 1.5rem;
    }
    .quick-facts-card h3 {
        margin: 0 0 1rem 0;
        color: #E2E8F0;
    }
    .quick-facts-card ul {
      margin: 0;
      padding-left: 20px;
      color: #94A3B8;
    }
    .quick-facts-card li {
      margin-bottom: 0.5rem;
    }
    .loader-container { text-align: center; padding: 4rem 0; }
    .loader { width: 50px; aspect-ratio: 1; border-radius: 50%; border: 8px solid #334155; border-top-color: #3B82F6; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .error-message { text-align: center; padding: 2rem; background: #3a1a1a; color: #fca5a5; border: 1px solid #b91c1c; border-radius: 8px; }
  </style>
</head>
<body style="background-color: #0F172A;"> 

  <div class="page-wrapper">

    <header class="header">
      <a href="index.html" class="logo-section">
        <div class="logo-badge"> <img class="logo" src="logo.png" alt="Nazarban Logo" /> </div>
        <div class="brand-text">
          <div class="brand-name">NAZARBAN</div>
          <div class="brand-tagline">ANALYTICS Â· FZCO</div>
        </div>
      </a>
      <div class="header-right-group">
          <nav class="nav-desktop">
            <a href="benchmark.html" class="active-page" data-lang-key="nav_insight">Benchmarks</a>
            <a href="about.html" data-lang-key="nav_about">About</a>
            <a href="blog.html" data-lang-key="nav_blog">Blog</a>
            <a href="services.html" data-lang-key="nav_services">Services</a>
            <a href="whitepaper.html" data-lang-key="nav_whitepaper">White Paper</a>
          </nav>
          <div class="language-switcher">
            <a href="#" data-lang="en" data-lang-key="lang_en">EN</a>
            <a href="#" data-lang="fa" class="active" data-lang-key="lang_fa">FA</a>
          </div>
          <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
            <span class="bar"></span> <span class="bar"></span> <span class="bar"></span>
          </button>
      </div> 
    </header>

    <ul class="nav-mobile-overlay">
        <li><a href="benchmark.html" class="active-page" data-lang-key="nav_insight">Benchmarks</a></li>
        <li><a href="about.html" data-lang-key="nav_about">About</a></li>
        <li><a href="blog.html" data-lang-key="nav_blog">Blog</a></li>
        <li><a href="services.html" data-lang-key="nav_services">Services</a></li>
        <li><a href="whitepaper.html" data-lang-key="nav_whitepaper">White Paper</a></li>
        <div class="language-switcher">
        <a href="#" data-lang="en" data-lang-key="lang_en">EN</a>
        <a href="#" data-lang="fa" class="active" data-lang-key="lang_fa">FA</a>
      </div>
    </ul>
    
    
    <main class="benchmark-container" id="benchmark-content">
      <div class="benchmark-header">
        <h1 data-lang-key="benchmark_main_title">AI Model Benchmark Leaderboard</h1>
        <p id="last-updated" data-lang-key="benchmark_loading">Loading data...</p>
      </div>
      <div id="charts-container">
        <div class="loader-container">
          <div class="loader"></div>
          <p data-lang-key="benchmark_loading">Loading benchmark data...</p>
        </div>
      </div>
    </main>

  </div> 


  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <script src="js/main.js"></script> 
  <script src="js/chat.js"></script> 
  <script src="js/translations.js"></script> 
  <script src="js/language.js"></script> 

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // My custom translate() helper function is GONE
    
      const chartsContainer = document.getElementById('charts-container');
      const lastUpdatedEl = document.getElementById('last-updated');

      function showLoading() {
        chartsContainer.innerHTML = `
          <div class="loader-container">
            <div class="loader"></div>
            <p data-lang-key="benchmark_loading">Loading benchmark data...</p>
          </div>
        `;
      }

      function showError(message) {
        chartsContainer.innerHTML = `
          <div class="error-message">
            <strong data-lang-key="benchmark_error_title">Error loading benchmarks:</strong> ${message}
          </div>
        `;
        lastUpdatedEl.innerHTML = `<span data-lang-key="benchmark_data_error">Could not load data.</span>`;
      }

      function renderData(data) {
        // Clear the loader
        chartsContainer.innerHTML = `
          <div id="hero-stats-container" class="hero-stats-grid"></div>
          <div class="charts-grid">
            <div class="chart-card">
              <h2>${data.charts?.top_10_bar?.title || 'Top 10 AI Models'}</h2>
              <div id="top-10-bar-chart"></div>
            </div>
            <div class="chart-card">
              <h2>${data.charts?.top_5_radar?.title || 'Top 5 Model Comparison'}</h2>
              <div id="model-comparison-chart"></div>
            </div>
            <div class="chart-card">
              <h2 data-lang-key="benchmark_chart_champions">Category Champions</h2>
              <div id="category-winners-chart"></div>
            </div>
            <div class="chart-card">
              <h2>${data.charts?.provider_pie?.title || 'Top 10 Models by Provider'}</h2>
              <div id="provider-pie-chart"></div>
            </div>
          </div>
          <div id="leaderboard-container" class="leaderboard-container">
             <h2 data-lang-key="benchmark_table_title">Leaderboard</h2>
             <table class="leaderboard-table" id="leaderboard-table"></table>
          </div>
          <div id="insights-container" class="insights-grid"></div>
        `;
        
        // Date formatting
        try {
          const updatedDate = new Date(data.metadata.last_updated);
          const options = { year: 'numeric', month: 'long', day: 'numeric' };
          const lang = localStorage.getItem('preferredLanguage') || 'fa'; 
          const formattedDate = updatedDate.toLocaleDateString(lang === 'fa' ? 'fa-IR' : 'en-US', options);
          lastUpdatedEl.innerHTML = `<span data-lang-key="benchmark_updated_prefix">Updated:</span> ${formattedDate}`;
        } catch (e) {
          lastUpdatedEl.textContent = `Data loaded.`;
        }

        // Render all the new content
        renderHeroStats(data.hero_stats);
        renderTop10BarChart(data.charts.top_10_bar);
        renderTop5ComparisonChart(data.charts.top_5_radar);
        renderCategoryWinners(data.category_winners); 
        renderProviderPie(data.charts.provider_pie);
        renderLeaderboardTable(data.leaderboard); 
        renderInsights(data); 
        
        // *** THIS IS THE FIX ***
        // Now that all HTML is on the page, we call the new global function
        if (typeof window.updateContent === 'function') {
            window.updateContent();
        } else {
            console.error("language.js has not loaded window.updateContent() yet.");
        }
      }

      function renderHeroStats(stats) {
        if (!stats) return;
        const container = document.getElementById('hero-stats-container');
        container.innerHTML = `
          <div class="stat-card">
            <div class="stat-card-title" data-lang-key="benchmark_hero_top_model">Top Model</div>
            <div class="stat-card-value">${stats.top_model || 'N/A'}</div>
            <div class="stat-card-sub"><span data-lang-key="benchmark_hero_score_label">Score:</span> ${stats.highest_score || '0'}</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-title" data-lang-key="benchmark_hero_models">Models Analyzed</div>
            <div class="stat-card-value">${stats.total_models || '0'}</div>
            <div class="stat-card-sub">${stats.providers_count || '0'} <span data-lang-key="benchmark_hero_providers_label">Providers</span></div>
          </div>
        `;
      }

      function renderTop10BarChart(chartData) {
        if (!chartData) return;
        const options = {
          series: chartData.datasets.map(dataset => ({ name: dataset.label, data: dataset.data })), 
          chart: { type: 'bar', height: 350, fontFamily: '"Nunito Sans", sans-serif', toolbar: { show: false }, id: 'top10bar', group: 'llm-sync' },
          theme: { mode: 'dark' },
          grid: { borderColor: '#334155' },
          plotOptions: { bar: { horizontal: false, columnWidth: '55%', endingShape: 'rounded' } },
          dataLabels: { enabled: false },
          xaxis: { categories: chartData.labels, labels: { style: { colors: '#94A3B8' } } },
          yaxis: { labels: { style: { colors: '#94A3B8' } } },
          fill: { opacity: 1 }
        };
        new ApexCharts(document.querySelector("#top-10-bar-chart"), options).render();
      }

      function renderTop5ComparisonChart(chartData) {
        if (!chartData) return;
        const seriesData = chartData.datasets.map(dataset => ({ name: dataset.label, data: dataset.data }));
        const options = {
          series: seriesData,
          chart: { type: 'bar', height: 400, fontFamily: '"Nunito Sans", sans-serif', toolbar: { show: false }, id: 'top5compare', group: 'llm-sync' },
          theme: { mode: 'dark' },
          grid: { borderColor: '#334155' },
          plotOptions: { bar: { horizontal: false, columnWidth: '80%' } },
          dataLabels: { enabled: false },
          stroke: { show: true, width: 2, colors: ['transparent'] },
          xaxis: { categories: chartData.labels, labels: { style: { colors: '#E2E8F0', fontSize: '14px' } } },
          yaxis: { labels: { style: { colors: '#94A3B8' } } },
          fill: { opacity: 1 },
          legend: { position: 'top', offsetY: 0, labels: { colors: '#F1F5F9' } }
        };
        new ApexCharts(document.querySelector("#model-comparison-chart"), options).render();
      }

      function renderCategoryWinners(categoryData) {
        if (!categoryData || !Array.isArray(categoryData)) return;
        const series = [{ name: 'Score', data: categoryData.map(item => item.score) }];
        const categories = categoryData.map(item => `${item.display_name}: ${item.model_name}`);
        const options = {
          series: series,
          chart: { type: 'bar', height: 350, fontFamily: '"Nunito Sans", sans-serif', toolbar: { show: false } },
          theme: { mode: 'dark' },
          grid: { borderColor: '#334155' },
          plotOptions: { bar: { horizontal: true, distributed: true, borderRadius: 4 } },
          dataLabels: { enabled: true, style: { colors: ['#fff'] }, formatter: (val, opts) => categoryData[opts.dataPointIndex].provider, offsetX: -10 },
          xaxis: { categories: categories, labels: { style: { colors: '#94A3B8' } } },
          yaxis: { labels: { style: { colors: '#94A3B8', fontSize: '14px' } } },
          legend: { show: false } 
        };
        new ApexCharts(document.querySelector("#category-winners-chart"), options).render();
      }

      function renderProviderPie(chartData) {
        if (!chartData) return;
        
        const lang = localStorage.getItem('preferredLanguage') || 'fa';
        const totalLabel = (window.translations && translations[lang] && translations[lang]['benchmark_pie_total']) 
                           ? translations[lang]['benchmark_pie_total'] : 'Providers';

        const options = {
          series: chartData.datasets[0].data,
          labels: chartData.labels,
          chart: { type: 'donut', height: 400, fontFamily: '"Nunito Sans", sans-serif' },
          theme: { mode: 'dark' },
          plotOptions: { pie: { donut: { labels: { show: true, total: { show: true, label: totalLabel, color: '#94A3B8' } } } } },
          tooltip: { y: { formatter: (val) => (val === 1 ? "1 model" : val + " models"), title: { formatter: (seriesName) => seriesName } } },
          legend: { position: 'bottom', labels: { colors: '#F1F5F9' }, itemMargin: { horizontal: 5, vertical: 2 } },
          dataLabels: { enabled: false },
          responsive: [{
            breakpoint: 480, 
            options: {
              chart: { height: 300 },
              legend: { show: false },
              plotOptions: { pie: { donut: { labels: { show: true, total: { show: true, label: totalLabel, fontSize: '18px' } } } } }
            }
          }]
        };
        new ApexCharts(document.querySelector("#provider-pie-chart"), options).render();
      }

      function renderLeaderboardTable(leaderboardData) {
        if (!leaderboardData || !Array.isArray(leaderboardData)) return;
        const table = document.getElementById('leaderboard-table');
        let headerHTML = `
            <thead>
                <tr>
                    <th data-lang-key="benchmark_table_rank">Rank</th>
                    <th data-lang-key="benchmark_table_name">Model</th>
                    <th data-lang-key="benchmark_table_provider">Provider</th>
                    <th data-lang-key="benchmark_table_intelligence">Intelligence</th>
                    <th data-lang-key="benchmark_table_coding">Coding</th>
                    <th data-lang-key="benchmark_table_math">Math</th>
                    <th data-lang-key="benchmark_table_grade">Grade</th>
                </tr>
            </thead>
        `;
        let bodyHTML = '<tbody>';
        for (const model of leaderboardData) {
          bodyHTML += `
            <tr>
              <td class="rank">#${model.rank}</td>
              <td>${model.name}</td>
              <td>${model.provider}</td>
              <td>${model.intelligence}</td>
              <td>${model.coding}</td>
              <td>${model.math}</td>
              <td><span class="grade-c">${model.grade}</span></td>
            </tr>
          `;
        }
        bodyHTML += '</tbody>';
        table.innerHTML = headerHTML + bodyHTML;
      }
      
      function renderInsights(data) {
        const container = document.getElementById('insights-container');
        if (!container) return;
        const insights = data.insights || [];
        const staticFacts = data.quick_facts || []; 
        let insightsHTML = '';
        if (insights.length > 0) {
            for (const item of insights) {
                let typeKey = '';
                if (item.type === 'hidden_gem') {
                    typeKey = 'benchmark_insights_hidden';
                } else if (item.type === 'specialist') {
                    typeKey = 'benchmark_insights_specialist';
                } else {
                    typeKey = 'benchmark_insights_' + item.type;
                }
                insightsHTML += `
                    <div class="insight-card">
                        <h3 data-lang-key="${typeKey}">${item.type}</h3>
                        <h4>${item.title}</h4>
                        <p>${item.description}</p>
                    </div>
                `;
            }
        }
        let factsHTML = '';
        if (staticFacts.length > 0) {
            factsHTML = `
                <div class="quick-facts-card">
                    <h3 data-lang-key="benchmark_facts_title">Quick Facts</h3> 
                    <ul>
                        ${staticFacts.map(fact => `<li>${fact}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        container.innerHTML = insightsHTML + factsHTML;
      }
      
      async function fetchBenchmarkData() {
        showLoading();
        try {
          const response = await fetch('/api/benchmark/data');
          if (!response.ok) {
            throw new Error(`Failed to fetch: ${response.status} ${response.statusText}`);
          }
          const result = await response.json();
          if (result.success && result.data && typeof result.data === 'object') {
            console.log("Successfully fetched data:", result.data); 
            if (!result.data.charts || !result.data.leaderboard) {
              console.error("Data is missing 'charts' or 'leaderboard' key.", result.data);
              throw new Error("Data loaded, but it's missing key sections.");
            }
            renderData(result.data);
          } else {
            throw new Error(result.message || 'Data format is incorrect or empty.');
          }
        } catch (error) {
          console.error('Error fetching/rendering benchmark data:', error);
          showError(error.message);
        }
      }

      fetchBenchmarkData();
    });
  </script>
</body>
</html>